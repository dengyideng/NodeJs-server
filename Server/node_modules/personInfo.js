var fs = require('fs');

exports.personInfo = function(req, res){
	var paramStr = require('url').parse(req.url).query;
	var paramObj = require('querystring').parse(paramStr);

	var username = paramObj['username'];
	var password = paramObj['password'];

    var userStr = fs.readFileSync(BASE_DIR + '/database/user.json');
    var users = JSON.parse(userStr);
 
    /*for(var i in users.users){
    	if(users.users[i].name == username){
    		if(users.users[i].password == password){
    			res.writeHead(200, {'Content-Type' : 'application/json'});
    			res.write(JSON.stringify(users.users[i]));
    			res.end();
    			console.log("user information was returned!");
    			console.log(users.users[i]);
    			return;
    		}else{
    			res.writeHead(404, {'Content-Type' : 'text/plain'});
    			res.write("password error!");
    			res.end();
    			console.log("password error!");
    			return;
    		}
    	}
    }

    //用户不存在
    res.writeHead(404, {'Content-Type' : 'text/plain'});
    res.write("user was not exist in this database!");
    res.end();
    console.log("user was not exist in this database!");*/

    for(var i in users.users){
        if(users.users[i].name == username && users.users[i].password == password){
            res.writeHead(200, {'Content-Type' : 'application/json'});
            res.write(JSON.stringify(users.users[i]));
            res.end();
            console.log("user information was returned!");
            console.log(users.users[i]);
            return;
        }
    }

    res.writeHead(404, {'Content-Type' : 'text/plain'});
    res.write("username or password error!");
    res.end();
    console.log("username or password error!");
};