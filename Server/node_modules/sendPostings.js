var fs = require('fs');

exports.sendPostings = function(req, res){
	var paramStr = require('url').parse(req.url).query;
	var paramObj = require('querystring').parse(paramStr);

	var username = paramObj['username'];

    var userStr = fs.readFileSync(BASE_DIR + '/database/user.json');
    var users = JSON.parse(userStr);
    var postingsStr = fs.readFileSync(BASE_DIR + '/database/postings.json');
    var postings = JSON.parse(postingsStr);

    var postingsRet = {"postings" : []};

    /*for(var i in users.users){
        if(users.users[i].name == username && users.users[i].password == password){
            res.writeHead(200, {'Content-Type' : 'application/json'});
            res.write(JSON.stringify(users.users[i]));
            res.end();
            console.log("user information was returned!");
            console.log(users.users[i]);
            return;
        }
    }

    res.writeHead(404, {'Content-Type' : 'text/plain'});
    res.write("username or password error!");
    res.end();
    console.log("username or password error!");*/

    var temp = [],
        mark = false;

    for(var i in users.users){
        if(users.users[i].name == username){
            temp = users.users[i].postingsSend;
            mark = true;
            break;
        }
    }

    if(!mark){
        console.log("can not find this user!");
        res.writeHead(404, {'Content-Type' : 'text/plain'});
        res.write("can not find this user!");
        res.end();
    }else{
        for(var i in temp){
            for(var j in postings.postings){
                if(temp[i] == postings.postings[j].name){
                    postingsRet.postings.push(postings.postings[j]);
                }
            }
        }

        console.log("sendPostings have already returned!");
        res.writeHead(200, {'Content-Type' : 'application/json;charset=utf-8'});
        res.write(JSON.stringify(postingsRet));
        res.end();
    }

};