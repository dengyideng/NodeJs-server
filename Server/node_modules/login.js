/*module.exports = function(){
	var _res = arguments[0];
	var _req = arguments[1];

	this.checkSession = function(model){}
	if(model =='login'){
		return true;
	}else if(sessionLib.username && sessionLib.username !=''){
		return true;
	}
	return false;

	this.login = function(){
		lib.httpParam.POST('username', function(value){
			sessionLib.username = value;
			if(value == 'wangjiasong' || value == 'lixiang'){
				_res.render(VIEW + 'live.jade', {'user' : 'value'});
			}else{
				_res.render(VIEW + 'main.jade', {'user' : 'value'});
			}
		});
	};

	var time = 0;
	io.sockets.on('connection', function(socket){
		var username = sessionLib.username;
		if(!onLineList[username]){
			onLineList[username] = socket;
		}

		var refresh_online = function(){
			var n = [];
			for(var i in onLineList){
				n.push(i);
			}
			var message = lib.fs.readFileSync(BASE_DIR + '/live_data.txt', 'utf8');
			socket.emit('live_data', message);

			//向所有人广播
			io.sockets.emit('onLine_list', n);
		}
	});
};*/

var fs = require('fs');

exports.login = function(req, res){
	var paramStr = require('url').parse(req.url).query;
	var paramObj = require('querystring').parse(paramStr);

	var username = paramObj['username'];
	var password = paramObj['password'];

    var userStr = fs.readFileSync(BASE_DIR + '/database/user.json');
    var users = JSON.parse(userStr);

    //console.log(username);
    //console.log(password);
    //console.log(users);
    for(var i in users.users){
    	//console.log(users.users[i]);
    	if(users.users[i].name == username){
    		if(users.users[i].password == password){
    			res.writeHead(200, {'Content-Type' : 'application/json'});
    			res.write(JSON.stringify(users.users[i]));
    			res.end();
    			console.log("user was found!");
    			console.log(users.users[i]);
    			return;
    		}else{
    			res.writeHead(404, {'Content-Type' : 'text/plain'});
    			res.write("password error!");
    			res.end();
    			console.log("password error!");
    			return;
    		}
    	}
    }

    //用户不存在
    res.writeHead(404, {'Content-Type' : 'text/plain'});
    res.write("user was not exist in this database!");
    res.end();
    console.log("user was not exist in this database!");
};