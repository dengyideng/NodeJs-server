//用来传输图片
var _res, _req,
    fs = require('fs'),
    url = require('url'),
    querystring = require('querystring');

 exports.init = function(req, res){
	_res = res;
	_req = req;
};

exports.dealWithStatic = function(){
	var paramStr = url.parse(_req.url).query;
	var paramObj = querystring.parse(paramStr);

	//var realPath = STATIC +'/image/' + paramObj[picName];
	var realPath = BASE_DIR + '/static' +'/image/' + paramObj["picName"];

	console.log(realPath);

	fs.exists(realPath, function(exists){

		if(!exists){
			//_res.writeHead(404, {'Content-Type' : 'text/plain'});
			_res.write("Source was not found in this server!");
            _res.end();
            console.log('404');
		}else{
			fs.readFile(realPath, function(err, file){
				if(err){
					_res.writeHead(500, {'Content-Type' : 'text/plain'});
					_res.end(err);
					console.log("500");
				}else{
					_res.writeHead(200, {'Content-Type' : 'image/png'});
					_res.write(file);
					_res.end();
					console.log("200");
				}
			});
		}
	});
};