var fs = require('fs'),
    querystring = require('querystring'),
    newUser = {};

exports.register = function(req, res){
	var postData = '';
	req.addListener('data', function(postDataChunk){
		postData += postDataChunk;
	});

	req.addListener('end', function(){

		//console.log(decodeURI(postData));
		//var message = JSON.parse(decodeURI(postData));
		//console.log(message);

		var message = querystring.parse(postData);

		newUser.name = message['name'] ? message['name'] : '';
		newUser.age = message['age'] ? message['age'] : '';
		newUser.sex = message['sex'] ? message['sex'] : '';
		newUser.qq = message['qq'] ? message['qq'] : '';
		newUser.tell = message['tell'] ? message['tell'] : '';
		newUser.password = message['password'] ? message['password'] : '';

		newUser.postingsSend = '';
		newUser.postingsCollect = '';
		newUser.postingsComment = '';
		newUser.postingsBrowsed = '';

		var userStr = fs.readFileSync(BASE_DIR + '/database/user.json');
        var users = JSON.parse(userStr);
        users.users.push(newUser);
        console.log(users);
        fs.writeFile(BASE_DIR + '/database/user.json', JSON.stringify(users), function(err){
        	if(err){
        		console.log(err);
        	}else{
        		console.log("newUser has been added into database already!");
        	}
        });
	});
};