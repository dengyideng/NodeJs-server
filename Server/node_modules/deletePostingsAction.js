var fs = require('fs'),
    querystring = require('querystring');

exports.deletePostingsAction = function(req, res){
    var paramStr = require('url').parse(req.url).query;
    var paramObj = querystring.parse(paramStr);

    //var username = paramObj['username'];
    var postname = paramObj['postname'];

    var userStr = fs.readFileSync(BASE_DIR + '/data/user.json');
    var users = JSON.parse(userStr);
    var postingsStr = fs.readFileSync(BASE_DIR + '/data/postings.json');
    var postings = JSON.parse(postingsStr);

    for(var i in postings.postings){
        if(postings.postings[i].name == postname){
            postings.postings.splice(i, 1);

            fs.writeFileSync(BASE_DIR + '/data/postings.json', JSON.stringify(postings));

            console.log("delete post success!");
            res.writeHead(200, {'Content-Type' : 'text/plain'});
            res.write("delete post success!");
            res.end();
            return;
        }
    }

    console.log("can not find this post!");
    res.writeHead(200, {'Content-Type' : 'text/plain'});
    res.write("can not find this post!");
    res.end();
    
}
